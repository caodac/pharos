
@import play.Play
@import java.net.URLEncoder
@import ix.core.models.{Keyword, Publication, Text, VInt, Value}
@import ix.idg.controllers.Commons._
@import ix.idg.controllers.IDGApp._
@import ix.idg.controllers.{ExpressionApp, IDGApp, WordCloud}
@import ix.idg.models.Target.TDL
@import ix.idg.models.{Assay, Compartment, Disease, Ligand, Target, Techdev}
@import ix.utils.Util
@import ix.utils.Global
@import ix.core.models.XRef
@import ix.core.models.VNum

@(target: Target, diseases: List[DiseaseRelevance], breadcrumb: List[Keyword])

@facet(label: String, value: String, href: String = null, max: Int = 40) = {
  @defining(IDGApp.getTermCount(classOf[Target], label, value)) { count =>
    <div>@if(max > 0 && value.length > max) {
       <a id="keyword" class="label label-primary loader"
          data-toggle="tooltip"
       	  data-html="true"
       	  data-trigger="hover"
       	  data-placement="top"
       	  title="@value"
       	  data-content="<p align='left'>@value</p>"
       	  href='@{ix.idg.controllers.routes.IDGApp.targets()+"?facet="+URLEncoder.encode(label,"utf8")+"/"}@URLEncoder.encode(value, "utf8")'>@{value.substring(0, max)}... <span class="badge">@Util.format(count)</span></a>&nbsp;
     } else {
       <a id="keyword" class="label label-primary loader"
        @if(href != null && !href.startsWith("http")) {
          data-toggle="tooltip"
       	  data-html="true"
       	  data-trigger="hover"
       	  data-placement="top"
       	  title="<p align='left'>@href</p>"
	}
        href='@{ix.idg.controllers.routes.IDGApp.targets()+"?facet="+URLEncoder.encode(label,"utf8")+"/"}@URLEncoder.encode(value, "utf8")'>@value <span class="badge">@Util.format(count)</span></a>
     }
     @if(href != null && href.startsWith("http")) {
       <a href="@href"><i class="fa fa-external-link"></i></a>
     }</div>
  }
}

@keyword(kw: Keyword, max: Int = 40) = {
  @facet(kw.label, kw.term, kw.href, max)
}

@disease = {
  @if(diseases.length > 0) {
    @if(diseases.length > 10) {
       <div class="modal fade" id="disease-modal"
          tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
          aria-hidden="true">
          <div class="modal-dialog">
             <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close"
                        data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Diseases annotated for <em>@target.getName</em></h4>
                </div>
                <div class="modal-body">
                @for(d <- diseases) {
                  @if(d.comment != null) {
                    @*facet(UNIPROT_DISEASE, d.disease.name)*@
                    <span class="label label-default">@d.disease.name</span>
                  } else {
                    @facet(IDG_DISEASE, d.disease.name)
                  }
                }
                </div>
             </div>
          </div>
       </div>
       <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Disease (@diseases.length)</h3>
          </div>
          <div class="panel-body">
            @for(d <- diseases.slice(0,10)) {
               @if(d.comment != null) {
                    @*facet(UNIPROT_DISEASE, d.disease.name)*@
                    <span class="label label-default">@d.disease.name</span>
               } else {
                    @facet(IDG_DISEASE, d.disease.name)
               }
            }
            <a class="label label-danger"
                data-toggle="modal"
                data-target="#disease-modal"
                href="#">See all...</a>
          </div>
      </div>
    } else {
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Disease (@diseases.length)</h3>
        </div>
        <div class="panel-body">
            @for(d <- diseases) {
               @if(d.comment != null) {
                 @*facet(UNIPROT_DISEASE, d.disease.name)*@
                 <span class="label label-default">@d.disease.name</span>
               } else {
                 @facet(IDG_DISEASE, d.disease.name)
               }
            }
        </div>
      </div>
    }
  }
}

@propertyfacets(name: String, props: List[Value], href: String = null, dir: Int = 0, tooltip: String = "") = {
    @if(!props.isEmpty()) {
       @if(props.length > 10) {
       <div class="modal fade" id="@Util.sha1(name).substring(0,5)"
          tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
          aria-hidden="true">
          <div class="modal-dialog">
             <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close"
                        data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">@name for @target.getName</h4>
                </div>
                <div class="modal-body"
		     style="max-height:400px;overflow-y:auto;">
                    @for(p <- props) {
                        @p match {
                           case kw: Keyword => {
                               @keyword(kw, 0)
                           }
                           case _ => {
                           }
                        }
                     }
                </div>
             </div>
          </div>
       </div>
       <div class="panel panel-default">
          <div class="panel-heading">
            @if(href != null) {
              <h3 class="panel-title" data-toggle="tooltip" title="@tooltip">
                  @if(dir==0){<a class="loader" href="@ix.idg.controllers.routes.IDGApp.targetdescriptor(name)"><i class="fa fa-bar-chart"></i></a>&nbsp;}<a href="@href">@name <i class="fa fa-external-link"></i></a> (@props.length) <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/properties(label="+name+"*)"}'><i class="fa fa-code"></i></a></h3>
            } else {
              <h3 class="panel-title" data-toggle="tooltip" title="@tooltip">
                  @if(dir==0){<a class="loader" href="@ix.idg.controllers.routes.IDGApp.targetdescriptor(name)"><i class="fa fa-bar-chart"></i></a>&nbsp;}@name (@props.length) <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/properties(label="+name+"*)"}'><i class="fa fa-code"></i></a></h3>
            }
          </div>
          <div class="panel-body">
            @for(p <- props.subList(0,10)) {
               @p match {
                  case kw: Keyword => {
                    @keyword(kw)
                  }
                  case _ => {
                  }
               }
            }
            <a class="label label-danger"
                data-toggle="modal"
                data-target="#@Util.sha1(name).substring(0,5)"
                href="#">See all...</a>
          </div>
       </div>
       } else {
       <div class="panel panel-default">
          <div class="panel-heading">
            @if(href != null) {
              <h3 class="panel-title" data-toggle="tooltip" title="@tooltip">@if(dir==0){<a class="loader" href="@ix.idg.controllers.routes.IDGApp.targetdescriptor(name)"><i class="fa fa-bar-chart"></i></a>&nbsp;}<a href="@href">@name <i class="fa fa-external-link"></i></a> (@props.length) <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/properties(label="+name+"*)"}'><i class="fa fa-code"></i></a></h3>
            } else {
              <h3 class="panel-title" data-toggle="tooltip" title="@tooltip">@if(dir==0){<a class="loader" href="@ix.idg.controllers.routes.IDGApp.targetdescriptor(name)"><i class="fa fa-bar-chart"></i></a>&nbsp;}@name (@props.length) <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/properties(label="+name+"*)"}'><i class="fa fa-code"></i></a></h3>
            }
          </div>
          <div class="panel-body">
            @for(p <- props) {
               @p match {
                  case kw: Keyword => {
                    @keyword(kw)
                  }
                  case _ => {
                  }
               }
            }
          </div>
       </div>
       }
     }
}

@property(name: String, href: String = null, dir: Int = 0, tooltip: String = "") = {
  @defining(IDGApp.getProperties(target, name, dir)) { props =>
     @propertyfacets(name, props, href, dir, tooltip)
  }
}

@label(x: Value, title: String, label: String) = {
  @if(x.getValue().toString().length() > 50) {
       <a class="label label-@label loader"
           href="#@Util.sha1(x.getValue().toString()).substring(0,6)"
           tabindex="0"
           data-toggle="tooltip"
           data-animation="true"
           data-placement="top"
           data-trigger="click hover focus"
           data-title="@x.getValue"
           data-content="@x.getValue()">@x.getValue().toString().substring(0, 50)...</a></span>
  } else {
      <span class="label label-@label">@x.getValue()</span>
  }
}


@diseasedblink(d: Disease, x: Any) = {
<a href="http://diseases.jensenlab.org/Entity?documents=10&type1=9606&id2=@IDGApp.getId(d)&id1=@target.getSynonym(STRING_ID).term">@x</a>
}

@diffexprow(xref: XRef) = {
<tr>
    <td>
        @defining(xref.properties.filter(v => v.label == "IDG Disease").head.getValue().asInstanceOf[java.lang.String]) {dname =>
            @if(dname.length > 40) {
                <a id="keyword" class="label label-primary loader"
                   data-toggle="tooltip"
                   data-html="true"
                   data-trigger="hover"
                   data-placement="top"
                   title="@dname"
                   data-content="<p align='left'>@dname</p>"
                   >@{dname.substring(0,40)}... </a>
            } else {
                <a class="label label-primary loader"
                   href="@{ix.idg.controllers.routes.IDGApp.targets()+"?facet="+URLEncoder.encode(IDG_DISEASE,"utf8")+"/"+URLEncoder.encode(dname, "utf8")}">@dname</a>
            }
        }
    </td>
    <td>@{"%1$.3f".format(xref.properties.filter(v => v.label == "log2foldchange").head.getValue())}</td>
    <td>@{"%1$.3f".format(xref.properties.filter(v => v.label == "pvalue").head.getValue())}</td>
</tr>
}

@diseaserow(dr: DiseaseRelevance) = {
  @defining(IDGApp.getTermCount(classOf[Target], IDG_DISEASE, dr.disease.name)) { count =>
     <tr @*class="treegrid-@dr.disease.id"*@>
       <td>
         @if(dr.disease.name.length > 40) {
            <a id="keyword" class="label label-primary loader"
     	         data-toggle="tooltip"
       	  	 data-html="true"
       	  	 data-trigger="hover"
       	  	 data-placement="top"
       	  	 title="@dr.disease.name"
       	  	 data-content="<p align='left'>@dr.disease.name</p>"
                 href="@{ix.idg.controllers.routes.IDGApp.targets()+"?facet="+URLEncoder.encode(IDG_DISEASE,"utf8")+"/"+URLEncoder.encode(dr.disease.name, "utf8")}">@{dr.disease.name.substring(0,40)}... <span class="badge">@Util.format(count)</span>&nbsp;</a>
	 } else {
            <a class="label label-primary loader"
	        href="@{ix.idg.controllers.routes.IDGApp.targets()+"?facet="+URLEncoder.encode(IDG_DISEASE,"utf8")+"/"+URLEncoder.encode(dr.disease.name, "utf8")}">@dr.disease.name <span class="badge">@Util.format(count)</span></a>
	 }
       </td>
       <td>@diseasedblink(dr.disease,dr.zscore)</td>
       <td>@diseasedblink(dr.disease,dr.conf)</td>
       @**
       @if(dr.tinxScore != null) {
       <td>@{"%1$.3f".format(dr.tinxScore)}</td>
       } else {
       <td></td>
       }
       **@
     </tr>

     @for(i <- 0 until dr.lineage.size()) {
       @defining(dr.lineage(i)) { x =>
         <tr class="treegrid-@x.disease.id treegrid-parent-@dr.disease.id">
            <td><a class="loader" href="@ix.idg.controllers.routes.IDGApp.disease(IDGApp.getId(x.disease))">@x.disease.name</a></td>
            <td>@diseasedblink(x.disease,x.zscore)</td>
            <td>@diseasedblink(x.disease,x.conf)</td>
            @if(x.tinxScore != null) {
            <td>@{"%1$.3f".format(x.tinxScore)}</td>
            } else {
            <td></td>
            }
         </tr>
       }
     }
   }
}

@expression(name: String, skull: String, ext: Keyword = null) = {
   <div class="row">
      <div class="col-md-6">
         <img class="img-responsive" height="200" src='@ix.idg.controllers.routes.ExpressionApp.homunculus(IDGApp.getId(target), skull)' />

      </div>
      <div class="col-md-6" style="max-height:300px;overflow-y: auto;">
         @defining(ExpressionApp.getLinkedExpr(target, name)){ exprs =>
         <div class="panel-body">
            @for(expr <- exprs) {
               @if(expr.sourceid.equals(name)) {
                  @facet(expr.sourceid.replaceAll("Expression", "Tissue"), expr.tissue)
               }
            }
            @if(ext != null) {
                <a class="label label-danger" href="@ext.href">See source... <i class="fa fa-external-link"></i></a>
            }
         </div>
         }
      </div>
  </div>
}

@ligandActivityReport(t: Target) = {
      @t.idgFamily match {
          case "Kinase" => {
              @if(IDGApp.getMinimumLigandActivity(t) >= 7.5) {
                  with at least one activity < 30 nM
              } else {
                  but has no reported activity < 30 nM
              }
          }
          case "IC" | "Ion Channel" => {
              @if(IDGApp.getMinimumLigandActivity(t) >= 5.0) {
                  with at least one activity < 10uM
              } else {
                  but has no reported activity < 10uM
              }
          }
          case "NR" => {
              @if(IDGApp.getMinimumLigandActivity(t) >= 7.0) {
                  with at least one activity < 10uM
              } else {
                  but has no reported activity < 10uM
              }
          }
          case "GPCR" | "oGPCR" => {
              @if(IDGApp.getMinimumLigandActivity(t) >= 7.0) {
                  with at least one activity < 10uM
              } else {
                  but has no reported activity < 10uM
              }
          }

          case _ => {

          }
      }

}

@explainTdl(t: Target) = {
    @t.idgTDL match {
    case TDL.Tdark => {
        has a Pubmed text-mining score of @t.jensenScore, @IDGApp.getGeneRIFs(t).size() GeneRIFs
        and @t.antibodyCount antibodies
    }
    case TDL.Tclin => {
        is associated with @IDGApp.getDrugLigands(t).size() approved drugs and passes the cutoffs for Tdark
        (Pubmed text mining score of @t.jensenScore, @IDGApp.getGeneRIFs(t).size()
        GeneRIFs and @t.antibodyCount antibodies), is annotated with
        @(IDGApp.getProperties(t, GO_COMPONENT, 0).size()+IDGApp.getProperties(t, GO_FUNCTION, 0).size()+IDGApp.getProperties(t, GO_PROCESS, 0).size())
        GO terms and has @IDGApp.getOmimPhenotypes(t).size() confirmed OMIM phenotypes.
    }
    case TDL.Tbio => {
        passes the cutoffs for Tdark (Pubmed text mining score of @t.jensenScore, @IDGApp.getGeneRIFs(t).size()
        GeneRIFs and @t.antibodyCount antibodies). In addition it is annotated with
        @(IDGApp.getProperties(t, GO_COMPONENT, 0).size()+IDGApp.getProperties(t, GO_FUNCTION, 0).size()+IDGApp.getProperties(t, GO_PROCESS, 0).size())
        GO terms and has @IDGApp.getOmimPhenotypes(t).size() confirmed OMIM phenotypes.
    }
    case TDL.Tchem => {
        is associated with @IDGApp.getChemblLigands(t).size() ChEMBL compounds (@ligandActivityReport(t)) and passes the cutoffs for Tdark
        (Pubmed text mining score of @t.jensenScore, @IDGApp.getGeneRIFs(t).size()
        GeneRIFs and @t.antibodyCount antibodies), is annotated with
        @(IDGApp.getProperties(t, GO_COMPONENT, 0).size()+IDGApp.getProperties(t, GO_FUNCTION, 0).size()+IDGApp.getProperties(t, GO_PROCESS, 0).size())
        GO terms and has @IDGApp.getOmimPhenotypes(t).size() confirmed OMIM phenotypes.
    }

    case _ => {
       Something went wrong
    }
    }
}

@ligandrow(lig: Ligand) = {
<tr>
   <td>
   @defining(IDGApp.getStructure(lig)) { struc =>
      @if(struc != null) {
          <a tabindex="-1"
             data-toggle="tooltip"
             data-animation="true"
             data-placement="top"
             data-trigger="click hover focus"
             data-title="@lig.getName()"
             data-html="true"
             data-content="<img src='@ix.ncats.controllers.routes.App.structure(struc.getId,"svg",200,null)'>">
             <img alt="Structure of @IDGApp.getId(lig)"
                src='@ix.ncats.controllers.routes.App.structure(struc.getId,"svg",80,null)'></a>
      }
   }
   </td>
   <td class="valign-center">
      <a class="label label-primary loader" href='@ix.idg.controllers.routes.IDGApp.ligand(IDGApp.getId(lig))'>@lig.getName()</a>
   </td>
   @defining(IDGApp.getActivity(target, lig)) { act =>
      @if(act != null) {
         <td class="valign-center">
             <code>@{act.label} @{"%1$.2f".format(act.getValue())}</code>
         </td>
      } else {
         <td></td>
      }
   }
</tr>
}

@ligandcell(lig: Ligand) = {
   @defining(IDGApp.getStructure(lig)) { struc =>
       <div class="carousel-cell">
         <div class="thumbnail" style="border:0px; padding:0px;">
         @if(struc != null) {
           <img class="carousel-image" alt="Structure of @IDGApp.getId(lig)"
		src='@ix.ncats.controllers.routes.App.structure(struc.getId,"svg",150,null)'>
	 } else {
           <img alt="No structure for @IDGApp.getId(lig)"
		src='@routes.Assets.versioned("images/npc_logo.png")'/>
	 }
	   <div class="caption" style="padding:0px;">
             <p class="text-center"><a class="loader" href='@ix.idg.controllers.routes.IDGApp.ligand(IDGApp.getId(lig))'>@lig.getName()</a>
             @defining(IDGApp.getActivity(target, lig)) { act =>
               @if(act != null) {
	         @act.label match {
	           case "AC50" | "XC50" | "IC50" | "EC50" | "Ki" | "Kd" => {
                     <br>p@{act.label} @{"%1$.2f".format(act.getValue())}
	           }
	           case _ => {
                     <br>@{act.label} @{"%1$.2f".format(act.getValue())}
		     }
		 }
               } else {
                  <br>
	       }
	     }
	     </p>
	   </div>
         </div>
       </div>
   }
}

@ligandcarousel(title: String, ligands: List[Ligand]) = {
       @if(!ligands.isEmpty()) {
         <div class="row">
	    <div class="col-md-12">
               <div class="panel panel-default">
                  <a name="@{title}s" tocname="@{title}s"></a>
                  <div class="panel-heading">
                       <h3 class="panel-title"><a class="loader" href='@{ix.idg.controllers.routes.IDGApp.ligands() + "?facet=" + IDG_TARGET+"/"+target.getSynonym(UNIPROT_GENE).term}'>
                           <span data-toggle="tooltip" title="Carousel allowing for horizontal scrolling of ligand lists and drug lists.  The order is based on reported pKd or pKi.">@title</span> (@Util.format(ligands.size))</a> <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/links(kind="+classOf[Ligand].getName+")"}'><i class="fa fa-code"></i></a></h3>
                  </div>
		  <div class="panel-body" style="height:250px;">
		    <div class="ligand-carousel">
                       @if(ligands.size > 20) {
                           @for(l <- ligands.subList(0, 20)) {
			        @ligandcell(l)
			   }
			   <div class="carousel-cell">
			     <div style="position:absolute;top:70px;margin-left:30px;">
			       <a class="loader" href='@{ix.idg.controllers.routes.IDGApp.ligands() + "?facet=" + IDG_TARGET+"/"+target.getSynonym(UNIPROT_GENE).term}'><i class="fa fa-ellipsis-h fa-5x"></i><br> See all @{ligands.size} @{title.toLowerCase}s...</a>
			     </div>
			   </div>
		       } else {
		          @for(l <- ligands) {
		             @ligandcell(l)
			  }
		       }
		     </div>
		   </div>
	       </div>
	    </div>
	 </div>
       }
}

@techdev(t: Target) = {
  @defining(IDGApp.getLinkedObjects(t, classOf[Techdev])){ techdev =>
     @if(techdev != null && !techdev.isEmpty) {
        <div class="panel panel-default"
              style="max-height: 300px; overflow-y: auto;">
           <a name="techdev" tocname="TechDev Info"></a>
           <div class="panel-heading">
              <h3 class="panel-title"><a class="loader" href='@ix.idg.controllers.routes.IDGApp.targetdescriptor(TECHDEV_PI)'><i class="fa fa-bar-chart"></i></a>
                      &nbsp;
                      <span data-toggle="tooltip" title="Listing of PI from IDG funded Technology Development Centers that have reported working on particular target. ">
                          TechDev Info</span> (@techdev.size) <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/links(kind="+classOf[Techdev].getName+")"}'><i class="fa fa-code"></i></a></h3>
           </div>
           <div class="panel-body">
	     <table class="table table-striped">
               @for(td <- techdev){
	          <tr>
		    <td>
		      <a id="keyword" class="label label-primary loader"
          	      	 href='@{ix.idg.controllers.routes.IDGApp.targets()+"?facet="+URLEncoder.encode(TECHDEV_PI,"utf8")+"/"}@URLEncoder.encode(td.pi, "utf8")'>@td.pi <span class="badge">@IDGApp.getTermCount(classOf[Target], TECHDEV_PI, td.pi)</span></a>
		    </td>
		    <td>
		    @if(td.resourceUrl != null) {
	               <a href="@td.resourceUrl">@td.comment <i class="fa fa-external-link"></i></a>
		    } else {
		       @td.comment
		    }
		    </td>
		  </tr>
                }
	     </table>
           </div>
        </div>
     }
  }
}

@assayrow(a: Assay) = {
  @defining(a.getProperty(MLP_ASSAY_AID)) { aid =>
      @if(aid != null) {
         <tr>
           <td align="right">
             <a href="https://pubchem.ncbi.nlm.nih.gov/bioassay/@aid.getValue">@aid.getValue</a>
           </td>
           <td><code>@a.getType</code></td>
           <td>
             @defining(a.getProperty(MLP_ASSAY_ACTIVE)) { p =>
                @if(p != null) {
                   <a href="https://www.ncbi.nlm.nih.gov/pcsubstance?linkname=pcassay_pcsubstance_active&from_uid=@aid.getValue">@p.getValue</a>
                }
             }
             /
             @defining(a.getProperty(MLP_ASSAY_INCONCLUSIVE)) { p =>
                @if(p != null) {
                   @p.getValue
                }
             }
             /
             @defining(a.getProperty(MLP_ASSAY_INACTIVE)) { p =>
                @if(p != null) {
                   <a href="https://www.ncbi.nlm.nih.gov/pcsubstance?linkname=pcassay_pcsubstance_inactive&from_uid=@aid.getValue">@p.getValue</a>
                }
             }
           </td>
           <td>@a.name</td>
         </tr>
      }
  }
}

@targetsummary(target: Target) = {
   @defining(IDGApp.getProperties(target, "Count", 1)) { props =>
      @if(!props.isEmpty()) {
<div class="panel panel-default" >
  <a name="properties" tocname="Properties"></a>
  <div class="panel-heading">
    <h3 class="panel-title">
      <span data-toggle="tooltip" title="Table summarizing target characteristics tallied by Pharos. Antibody counts from Antibodypedia, EBI Total Patent Count, Monoclonal Antibody count from Antibodypedia, NCBI Gene PubMed Count, Grant Count, R01 Count, Funding ($) from NIH, JensenLab PubMed Score and temporal graph">
        Property Summary</span></h3>
  </div>
  <div class="panel-body">
    <table class="table table-striped">
      @for(p <- props) {
        @p match {
           case iv: VInt => {
 	     @if(iv.intval != null) {
	<tr>
          <td>
	        @iv.label match {
                   case "Ab Count" => {
                <span data-toggle="tooltip"
                      data-html="true"
                      title="<p align='left'>Antibody count from antibodypedia.com</p>"><a href="@IDGApp.getProperties(target, URL_ANTIBODYPEDIA).get(0) match { case s: Text => @s.getValue()}">Antibody</a></span>
                    }
                    case "MAb Count" => {
                <span data-toggle="tooltip"
                      data-html="true"
                      title="<p align='left'>Monoclonal Antibody count from antibodypedia.com</p>"><a href="@IDGApp.getProperties(target, URL_ANTIBODYPEDIA).get(0) match { case s: Text => @s.getValue()}">Monoclonal Antibody</a></span>
                     }
                     case "PubMed Count" => {
                <span data-toggle="tooltip"
                      data-html="true"
                      title="<p align='left'>Number of PubMed references for target and all its aliases</p>">PubMed</span>
                     }
                     case "TM Count" => {
                <span data-toggle="tooltip"
                      data-html="true"
                      title="<p align='left'>Number of transmembrane helices according to Survey of the Human Transmembrane Proteome (https://modbase.compbio.ucsf.edu/projects/membrane/). At least 2 are required to be in their list.</p>">Transmembrane</span>
                      }
                      case _ => {
                          @iv.label
                      }
                }
          </td>
          <td>@Util.format(iv.intval)</td>
	</tr>
	     }
           }
           case _ => {
           }
        }
     }
     @if(target.grantCount != null) {
        <tr>
          <td>
            <span data-toggle="tooltip"
                  data-html="true"
                  title="<p align='left'>Number of NIH funded grant applications for 2010-2014 based on text mining of application titles and abstracts, due to nature of text mining results might be inaccurate</p>">Grant Count</span>
          </td>
          <td>@Util.format(target.grantCount)</td>
        </tr>
      }
      @if(target.r01Count != null) {
        <tr>
          <td><span data-toggle="tooltip"
                    data-html="true"
                    title="<p align='left'>Number of NIH funded R01 grants for 2010-2014 based on text mining of application titles and abstracts, due to nature of text mining results might be inaccurate</p>">R01 Count</span></td>
          <td>@Util.format(target.r01Count)</td>
        </tr>
      }
      @if(target.grantTotalCost != null) {
        <tr>
          <td><span data-toggle="tooltip"
                    data-html="true"
                    title="<p align='left'>NIH funding (2010-2014) based on text mining of grant application titles and abstracts, due to nature of text mining results might be inaccurate</p>">Funding</span></td>
          @if(target.grantTotalCost != null) {
          <td>$@Util.format(target.grantTotalCost)</td>
          } else {
          <td></td>
          }
        </tr>
       }
	@if(target.jensenScore != null) {
        <tr>
          <td><a href="@ix.idg.controllers.routes.IDGApp.pmscore()">PubMed Score</a></td>
          <td>@{"%.2f".format(target.jensenScore)}
        </tr>
	<tr>
	  <td colspan="2">
	    <div id="pubmedscore-plot" style="height:100px;"></div>
	  </td>
	</tr>
	}
	@if(target.pubTatorScore != null) {
        <tr>
          <td><a href="https://www.ncbi.nlm.nih.gov/CBBresearch/Lu/Demo/PubTator/">PubTator Score</a></td>
          <td>@{"%.2f".format(Math.pow(10,target.pubTatorScore))}</td>
        </tr>
	<tr>
	  <td colspan="2">
	    <div id="pubtator-plot" style="height:100px;"></div>
	  </td>
	</tr>
	}
    </table>
  </div>
</div>
       } else {
<div class="panel panel-default">
  <div class="panel-body">
  </div>
</div>
       }
    }
}

@targetpatent(target: Target) = {
  @if(target.patentCount != null && target.patentCount > 0) {
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      <span data-toggle="tooltip" title="Graph of timeline of patents based on EBI patent counts, with specific yearly values shown when hovering over year's dot.">
        Patent</span> (@Util.format(target.patentCount))</h3>
  </div>
  <div class="panel-body">
    <div id="patent-line-plot" style="height:200px;"></div>
  </div>
</div>
} else {
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      <span data-toggle="tooltip" title="Graph of timeline of patents based on EBI patent counts, with specific yearly values shown when hovering over year's dot.">
	Patent</span></h3>
  </div>
  <div class="panel-body">
    <h5><em>No data available</em></h5>
  </div>
</div>
  }
}

@targetheader(target: Target) = {
<div class="page-header">
  <h1>
    <table style="width:100%;">
      <tr>
        <td style="width:10%;">
          <span class="label label-@target.idgTDL.label"
                data-toggle="tooltip" data-html="true" data-placement="right"
                title="<p align='left'>@target.idgTDL.desc</p><p align='left' style='color:yellow;'>This target is classified as  @target.idgTDL because
		       it @explainTdl(target)</p>">@target.idgTDL</span>
        </td>
        <td style="padding:5px;"></td>
        <td><a href="#target-description"
	       data-toggle="collapse">@target.name</a></td>
        <td style="text-align:right;">
	  <div role="group">
            <div class="dropdown btn-group pull-right" role="group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-list"></i>
              </button>
              <ul class="dropdown-menu pull-left" id="toc">
		
              </ul>
            </div>
            <div class="dropdown btn-group pull-right" role="group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-shopping-cart"></i>&nbsp;<span id="sc-count"></span>
              </button>
              <ul class="dropdown-menu pull-left">
                <li><a href="#" id="sc-add-selected">Add to cart</a></li>
                <li><a href="@ix.idg.controllers.routes.DossierApp.view(null)" id="sc-view">View Collections</a></li>
                <li><a href="#" id="sc-empty">Empty Collection</a></li>
              </ul>
            </div>
	  </div>
        </td>
      </tr>
    </table>
  </h1>

  <div class="panel panel-default collapse" id="target-description">
    <div class="panel-body">
	   @defining(IDGApp.getDescriptions(target)){ text =>
	   @for(i <- 0 until text.length) {
	         @if(i > 0) {
		   <br><br>
		 }
		 @text(i)
	      }
	   }
    </div>
  </div>
  <br><i class="fa fa-comments"></i>&nbsp;<a href="#disqus_thread">Comments</a>
</div>
}
	  
@ix.ncats.views.html.main(target.name){
@targetmenu(null)
}{
<ol class="breadcrumb" style="margin-top:60px;">
  <li><a href="@ix.idg.controllers.routes.IDGApp.index()"><span class="fa fa-home"></span> Home</a></li>
    <li><a href="@ix.idg.controllers.routes.IDGApp.targets()">Targets</a></li>
    @for(kw <- breadcrumb) {
    <li><a class="loader" href="@kw.href">@kw.term</a></li>
    }
    <li class="active">@target.name</li>
</ol>
}{
@defining(target.getSynonym(IDG_TARGET)) { keyword =>
  @if(keyword != null) {
<!--
This is TCRD target <a href='@ix.core.controllers.v1.routes.RouteFactory.get("targets", target.id, null)'>@keyword.term</a>
--!>
  }
}
<div id="page-loader"></div>
<div class="container-fluid">
  <div class="col-md-12">
    @targetheader(target)

    <!-- first row --!>
    <div class="row">
      <div class="col-md-6">
	@targetsummary(target)
      </div>
      <div class="col-md-6">
	<div class="row">
	  <div class="col-md-12">
            <div class="panel panel-default">
              <div class="panel-heading">
		<a name="datatypes" tocname="Data Types"></a>
		<h3 class="panel-title">
		  <span data-toggle="tooltip"
			title="Radar plot depicting the variety of knowledge obtained by Pharos for a particular target. The more spikes in the plot, the more variety. The longer the length, the higher the quantity of that particular knowledge. Click expansion icon to explore the plot fuller by seeing plot with annotations of the different radii, allowing for aggregation of knowledge radii based on attribution type, group, or data type, as well as overlay plot with other information, and provide download file.">Knowledge Summary</span>
		  <a href="#" id="modal-radar-btn"
		     data-toggle="modal" data-target="#modal-radar">
                    <span class="fa fa-external-link pull-right" aria-hidden="true"></span>
		  </a>
		</h3>
              </div>
              <div class="panel-body">
		<div id="attr-type-radar" style="width: 100%;"></div>
              </div>
            </div>
	  </div>
	</div>
	<div class="row">
	  <div class="col-md-12">
            @targetpatent(target)
	  </div>
	</div>
      </div> <!-- col --!>
    </div> <!-- row --!>
  
    <!--
      -- Disease Relevance (second row)
      -->
    @if(!diseases.isEmpty()) {
    <div class="row">
      <div class="col-md-6">
        <div class="panel panel-default">
          <a name="tinx" tocname="TINX"></a>
          <div class="panel-heading">
            <h3 class="panel-title">TINX Plot
                  @defining(IDGApp.getDTOId(target)){ dto =>
                    @if(dto != null) {
                       <a href="http://dev.newdrugtargets.org/?target=@dto.replace("_","")">
                       <span class="fa fa-external-link pull-right" aria-hidden="true"></span></a>
                    }
                  }
            </h3>
          </div>
          <div class="panel-body" style="max-height:300px;">
            <div id="tinx-plot"></div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="panel panel-default">
          <a name="diseases" tocname="Diseases"></a>
          <div class="panel-heading">
            <h3 class="panel-title"><a class="loader" href="@ix.idg.controllers.routes.IDGApp.targetdescriptor(IDG_DISEASE)"><i class="fa fa-bar-chart"></i></a>&nbsp;
	    	<span data-toggle="tooltip"
                        data-html="true"
                        title="<p align='left'>Disease-gene associations mined from Medline Franklid et al, Methods, 2015, 83-89</p>">Disease Relevance</span> (@diseases.size()) <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/links(kind="+classOf[Disease].getName+")"}'><i class="fa fa-code"></i></a></h3>
          </div>
          <div class="panel-body table-responsive"
	       style="max-height:300px;overflow-y:auto;">
            <table class="tree table table-striped">
              <tr>
                <th>Disease</th>
                <th>Z-score <i class="fa fa-info-circle"
				  data-toggle="tooltip" data-placement="top" data-html="true"
				  title="<p align='left'>A normalized version of the co-occurence (of the disease and this target) score, described in <a href='http://www.sciencedirect.com/science/article/pii/S1046202314003831'>Franklid et al, Methods, 2015, 83-89</a></p>"></i></th>
                <th>Confidence <i class="fa fa-info-circle"
				     data-toggle="tooltip" data-placement="top" data-html="true"
				     title="<p align='left'>Half the Z-score, described in <a href='http://www.sciencedirect.com/science/article/pii/S1046202314003831'>Franklid et al, Methods, 2015, 83-89</a></p>"></i></th>
		   @** this doesn't seem to be available anymore?
                   <th>Importance <i class="fa fa-info-circle"
				     data-toggle="tooltip" data-placement="top" data-html="true"
				     title="<p align='left'>A score characterizing the importance of the target, based on occurences in the published literature.</p>"></i></th>
		   **@
                </tr>
                     @for(dr <- diseases) {
                            @diseaserow(dr)
                     }
		</table>
          </div>  @* panel-body *@
        </div>
      </div>
    </div>
     }



    <!--
      -- Expression (third row)
      -->
    <div class="row">
      <div class="col-md-12">
         <div class="panel panel-default">
             <a name="expression" tocname="Gene/Protein Expression"></a>
            <div class="panel-heading">
               <h3 class="panel-title">
                   <span data-toggle="tooltip" data-html="true" title="Gene expression data from various sources. See
                                  <a href='@ix.idg.controllers.routes.IDGApp.faq()#collapse7?expand=true'>FAQ</a> for more details">
                       Expression</span>
		       <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/properties(label=*Tissue)"}'><i class="fa fa-code"></i></a>
               </h3>
            </div>
            <div class="panel-body">
               <div class="row">
                 <div class="col-md-4">

                     <ul class="nav nav-tabs">
                         <li role="presentation" class="active">
                             <a id="exprtab-specificity" href="#specificity-tab" role="tab" aria-controls="specificity"
                                data-toggle="tab">
                                <span data-toggle="tooltip" data-html="true" title="<p align='left'>Target tissue specificity, ranges from 0 (non-specific) - 1 specific to one tissue, calculated according to Yanai et al, Bioinformatics 2005, 650-659</p>">
                                    Specificity
                                </span>
                             </a>
                         </li>
                         <li role="presentation">
                             <a id="exprtab-diffexp" href="#diffexp-tab" role="tab" aria-controls="diffexp"
                                data-toggle="tab">
                                <span data-toggle="tooltip" data-html="true" title="Differential Expression">
                                    Differential
                                </span>
                             </a>
                         </li>
                     </ul>

                     <div class="tab-content">
                         <div role="tabpanel" class="tab-pane active" id="specificity-tab">
                             <div class="panel panel-default">
                                 <div class="panel-body" style="max-height: 300px">
                                     <div id="tissue-specificity-radar" style="margin: 0 auto; width: 100%;"></div>
                                 </div>
                             </div>
                         </div>
                         <div role="tabpanel" class="tab-pane" id="diffexp-tab">
                             @defining(IDGApp.getDiseasesWithDifferentialExpression(target)) {xrefs =>
                                 @if(xrefs.size() > 0) {
                                     <div class="panel panel-default">
                                         <a name="diffexpression" tocname="Differential Expression"></a>
                                         <div class="panel-heading">
                                             <h3 class="panel-title">&nbsp;
                                                 <span data-toggle="tooltip"
                                                       data-html="true"
                                                       title="<p align='left'>Diseases in which this target has shown to have differential expression as reported in
                                                                           Expression Atlas</p>">Differential Expression</span> (@xrefs.size())
                                                 <a class="pull-right"
                                                    href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/links(kind="+classOf[Disease].getName+")"}'><i
                                                         class="fa fa-code"></i></a></h3>
                                         </div>
                                         <div class="panel-body table-responsive" style="max-height:300px;overflow-y:auto;">
                                             <table id="diffexptable" class="tree table table-striped">
                                                 <thead>
                                                 <tr>
                                                     <th data-sort="string">Disease</th>
                                                     <th data-sort="float">log2 FC <i class="fa fa-info-circle"
                                                                                      data-toggle="tooltip" data-placement="top" data-html="true"
                                                                                      title="<p align='left'>log2 Fold Change is the ratio between the expression level in the normal state vs the disease state. Larger absolute values imply a bigger difference in expression between healthy and disease states</p>"></i>
                                                     </th>
                                                     <th data-sort="float">p <i class="fa fa-info-circle"
                                                                                data-toggle="tooltip" data-placement="top" data-html="true"
                                                                                title="<p align='left'>The p-value associated with the fold change.</p>"></i>
                                                     </th>
                                                 </tr>
                                                 </thead>
                                                 <tbody>
                                                 @for(axref <- xrefs) {
                                                 @diffexprow(axref)
                                                 }
                                                 </tbody>
                                             </table>
                                         </div>
                                     </div>
                                 }
                             }
                         </div>
                     </div>


                 </div>

               <div class="col-md-8">
                   <ul class="nav nav-tabs">
                       <li role="presentation" class="active">
		       	   <a id="exprtab-@GTEx_TISSUE"
			      href="#gtex-tab" role="tab" aria-controls="gtex"
			      data-toggle="tab">
                           <span data-toggle="tooltip"
                           data-html="true"
                           title="<p align='left'>Tissue expression data from The Genotype-Tissue Expression (GTEx) project</p>">
                               GTEx</span></a></li>

                       <li role="presentation">
		       	   <a id="exprtab-@HPM_TISSUE"
			      href="#hpm-tab" role="tab" data-toggle="tab">
                           <span data-toggle="tooltip"
                           data-html="true"
                           title="<p align='left'>Tissue expression data from The Human Proteome Map (HPM)</p>">
                               HPM</span></a></li>

                       <li role="presentation">
		       	   <a id="exprtab-@HPA_RNA_TISSUE"
			      href="#hpa-tab" role="tab" data-toggle="tab">
                           <span data-toggle="tooltip"
                           data-html="true"
                           title="<p align='left'>Tissue expression data from The Human Protein Atlas</p>">
                               HPA</span></a></li>

                       <li role="presentation">
		       	   <a id="exprtab-@IDG_TISSUE"
			      href="#idg-tab" role="tab" aria-controls="idg"
			      data-toggle="tab">
                           <span data-toggle="tooltip"
                           data-html="true"
                           title="<p align='left'>Consolidated tissue expression (combining GTEx, HPM and HPA)</p>">
                               IDG </span></a>

                       </li>
		       <li role="presentation">
		           <a id="exprtab-@UNIPROT_TISSUE"
			      href="#uniprot-tab" aria-controls="uniprot"
			      data-toggle="tab">
                           <span data-toggle="tooltip"
                           data-html="true"
                           title="<p align='left'>UniProt tissue expression data</p>">
                               UniProt
                           </span></a></li>
                       <li role="presentation">
		           <a id="exprtab-@JENSEN_KB_TISSUE"
		       	      href="#jensen-kb-tab" aria-controls="jensen-kb"
			      data-toggle="tab">
                           <span data-toggle="tooltip"
                           data-html="true"
                           title="<p align='left'>Tissue expression data from the Jensen Lab UniProtKB</p>">
                               Jensen-KB
                           </span></a></li>
                       <li role="presentation">
		         <a id="exprtab-@JENSEN_TM_TISSUE"
			      href="#jensen-tm-tab" aria-controls="jensen-tm"
			      data-toggle="tab">
                           <span data-toggle="tooltip"
                           data-html="true"
                           title="<p align='left'>Text mined tissue expression data from the Jensen Lab</p>">
                               Jensen-TM
                       </span></a></li>
			   <li class="pull-right">
			     <a id="tissue-descriptor" class="loader" href="@ix.idg.controllers.routes.IDGApp.targetdescriptor(GTEx_TISSUE)"><i class="fa fa-bar-chart"></i></a></li>
                   </ul>
                   <div class="tab-content">
                       <div role="tabpanel" class="tab-pane active" id="gtex-tab">
                       @expression(GTEx_EXPR, "gtex")
                       </div>
                       <div role="tabpanel" class="tab-pane" id="hpm-tab">
                       @expression(HPM_EXPR, "hpm")
                       </div>
                       <div role="tabpanel" class="tab-pane" id="hpa-tab">
                       @expression(HPA_RNA_EXPR, "hpa")
                       </div>
                       <div role="tabpanel" class="tab-pane" id="idg-tab">
                       @expression(IDG_EXPR, "idg")
                       </div>
                       <div role="tabpanel" class="tab-pane" id="uniprot-tab">
                       @expression(UNIPROT_TISSUE, "uniprot")
                       </div>
                       @defining(target.getProperty(IDG_TISSUE_REF)) { ref =>
                           <div role="tabpanel" class="tab-pane" id="jensen-kb-tab">
                                @expression(JENSEN_KB_EXPR, "jensen-kb", ref.asInstanceOf[Keyword])
                           </div>
                           <div role="tabpanel" class="tab-pane" id="jensen-tm-tab">
                               @expression(JENSEN_TM_EXPR, "jensen-tm", ref.asInstanceOf[Keyword])
                           </div>
                       }
                   </div>
               </div>
               </div>
            </div>
          </div> <!-- panel-body -->
       </div> <!-- col-md-12 -->
    </div> <!-- row -->

    <!--
      -- fourth row
      -->
    <div class="row">
      <div class="col-md-4" >
	<!--
        -- Synonyms
        -->
        <a name="synonym"  tocname="Synonyms"></a>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
                <span data-toggle="tooltip" title="Table listing different Uniprot linked Accession values, as well as Symbols or commonly used abbreviations associated with this particular target.">
                    Synonym</span>
                <a href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/synonyms"}'>
                    <span class="fa fa-code pull-right"></span></a>
            </h3>
          </div>
          <div class="panel-body">
            <table class="table">
              <tr>
                <td>Accession</td>
                <td>
                  @for(kw <- target.synonyms) {
                     @if("UniProt Accession".equals(kw.label)) {
                        <a href="@kw.href">@kw.term</a>
                     }
                  }
                </td>
              </tr>
              @**
              <tr>
                <td>Fullname</td>
                <td>
                  @for(kw <- target.synonyms) {
                     @if("UniProt Fullname".equals(kw.label)) {
                        @kw.term<br>
                     }
                  }
                </td>
              </tr>
              **@
              <tr>
                <td>Symbols</td>
                <td>
                  @for(kw <- target.synonyms) {
                     @if("UniProt Shortname".equals(kw.label)) {
                             @kw.term<br>
                     }
                  }
                </td>
              </tr>
            </table>
          </div>
        </div>
      <!--
        -- Genes
        -->
        <div class="panel panel-default">
            <a name="genes" tocname="Genes"></a>
          <div class="panel-heading">
            <h3 class="panel-title">
                <span data-toggle="tooltip" title="Approved gene symbol with link to HUGO Gene Nomenclature Committee.">
                    Gene</a> <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/synonyms(label="+UNIPROT_GENE+")"}'><i class="fa fa-code"></i></a></h3>
          </div>
          <div class="panel-body">
            @for(kw <- target.synonyms) {
                @if("UniProt Gene".equals(kw.label)) {
                    <a href="http://www.genenames.org/cgi-bin/gene_symbol_report?match=@kw.term">@kw.term</a>
                }
            }
          </div>
        </div>

        @property(PANTHER_PROTEIN_CLASS, null, -1, "Count of target mentioned in different PANTHER Protein classes reported in parenthesis.")
        @property(ChEMBL_PROTEIN_CLASS, null, -1)
        @property(GRANT_APPLICATION, null, 0, "Count of NIH grant applications including target reported in parenthesis. Listing individual grants with links to NIH RePORT site and tally of occurance of target for particular grant in circle. Click on the bargraph icon to explore further the Summary of Grant Application information.")
        @defining(target.getSynonyms(PDB_ID)) { pdbids =>
              @if(pdbids.size() > 0) {
                  <div class="panel panel-default"
                       style="max-height: 300px; overflow-y: auto;">
                      <a name="pdb" tocname="PDB"></a>
                      <div class="panel-heading">
                          <h3 class="panel-title">PDB
                              <a href="http://www.rcsb.org/pdb/protein/@IDGApp.getId(target)">
                                  <span class="fa fa-external-link pull-right"></span>
                              </a>

                              <a href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/synonyms(label="+PDB_ID+")"}'>
                                  <span class="fa fa-code pull-right"></span></a></h3>
                      </div>
                      <div class="panel-body">
                          @for(aval <- pdbids){
                          <a href="http://www.rcsb.org/pdb/explore.do?structureId=@aval.getValue()">@aval.getValue()</a> &nbsp;
                            }
                      </div>
                  </div>
              }
          }
        @techdev(target)
        @property(COLLECTION)
      </div>
      <div class="col-md-4">
        <a name="goterms" tocname="GO Terms"></a>
        @property(GO_FUNCTION, null, 0, "Function listed by GO database for target, with total count listed in parenthesis. Listing individual functions with links to GO. Click on bargraph icon to explore further the Summary of GO Function.")
        @property(GO_COMPONENT, null, 0, "Cellular component listed by GO database for target, with total count listed in parenthesis. Listing individual functions with links to GO. Click on bargraph icon to explore further the Summary of GO Function.")
        @property(GO_PROCESS, null, 0, "Biological process listed by GO database for target, with total count listed in parenthesis. Listing individual functions with links to GO. Click on bargraph icon to explore further the Summary of GO Function.")

	@defining(IDGApp.getCompartmentGOTerms(target)) { terms =>
	   @if(terms.size > 15) {
	      <div class="modal fade" id="compartment-modal"
              	   tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
		   aria-hidden="true">
		 <div class="modal-dialog">
             	    <div class="modal-content">
                       <div class="modal-header">
                       	  <button type="button" class="close"
                            	    data-dismiss="modal" aria-label="Close">
                               <span aria-hidden="true">&times;</span></button>
                          <h4 class="modal-title" id="myModalLabel">Compartment GO Terms for @target.getName</h4>
                       </div>
                       <div class="modal-body"
		       	    style="max-height:400px;overflow-y:auto;">
                          @for(t <- terms) {
                             @keyword(t, 0)
                          }
                       </div>
                    </div>
                 </div>
              </div>
              <div class="panel panel-default">
                <div class="panel-heading">
                   <h3 class="panel-title"><a class="loader" href='@ix.idg.controllers.routes.IDGApp.targetdescriptor(COMPARTMENT_GOTERM)'><i class="fa fa-bar-chart"></i></a>&nbsp;Compartment GO Term (@terms.size) <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/links(kind="+classOf[Compartment].getName+")"}'><i class="fa fa-code"></i></a></h3>
		</div>
                <div class="panel-body">
                  @for(t <- terms.subList(0, 15)) {
                    @keyword(t)
                  }
                  <a class="label label-danger"
                     data-toggle="modal"
		     @*data-target="#compartment-modal"*@
                     href="#compartment-modal">See all...</a>
          	</div>
              </div>
	   } else {
              <div class="panel panel-default">
                 <div class="panel-heading">
	           <h3 class="panel-title"><a class="loader" href='@ix.idg.controllers.routes.IDGApp.targetdescriptor(COMPARTMENT_GOTERM)'><i class="fa fa-bar-chart"></i></a>&nbsp;Compartment GO Term (@terms.size) <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/links(kind="+classOf[Compartment].getName+")"}'><i class="fa fa-code"></i></a></h3>
		 </div>
                 <div class="panel-body">
		     @for(t <- terms) {
		        @keyword(t)
		     }
		 </div>
      	       </div>
	   }
	}
      </div>
      <div class="col-md-4">
        @property(IMPC_TERM)
        @property(OMIM_TERM)
        @property(MGI_TERM)
        @property(GWAS_TRAIT)
        @property("Pathway", null, 1, "Biological pathways associated with target based on KEGG PATHWAY database, with links back to KEGG.")
        @property(UNIPROT_KEYWORD, null, 0, "Occurance of target in the 10 categories of UniProt keywords.")

        @defining(IDGApp.getPPI(target)) { ppi =>
          @if(!ppi.isEmpty) {
             <div class="panel panel-default">
                <div class="panel-heading">
                   <h3 class="panel-title">
                       <span data-toggle="tooltip" title="List of proteins potentially interacting with target. Coloration of proteins correspond with TDL (Tclin: dark blue, Tchem: light blue,  Tbio: orange, Tdark: red).">
                           Protein-protein Interaction (@ppi.size)</span> <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.page("predicates",10,0,"predicate='"+TARGET_PPI+"' AND subject.refid="+target.id)}'><i class="fa fa-code"></i></a></h3>
                </div>
                <div class="panel-body" style="max-height:300px; overflow-y:auto;">
                   @for(p <- ppi) {
		      <a class="label label-@p.idgTDL.label loader"
			  data-toggle="tooltip"
			  title='@p.name'
                          href='@ix.idg.controllers.routes.IDGApp.target(IDGApp.getId(p))'>
		      @defining(p.getSynonym(UNIPROT_GENE)) { gene =>
                         @if(gene != null && gene.term != null) {
                            @gene.term
                         } else {
                            @IDGApp.getId(p)
                         }
                      }
                      </a>&nbsp;
                   }
                </div>
             </div>
          }
        }
       </div>
    </div> <!-- row -->


    <!--
      -- MeSH
      -->
    @defining(IDGApp.getMesh(target)) { mesh =>
       @if(!mesh.isEmpty()) {
         <div class="modal fade" id="mesh" tabindex="-1"
            role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
          <div class="modal-dialog modal-lg">
             <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close"
                        data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Medical Subject Headings for <em>@target.getName</em></h4>
                </div>
                <div class="modal-body">
                  @for(m <- mesh) {
                    <a @if(m.majorTopic) {
                      class="label label-warning"
                    } else {
                      class="label label-primary"
                    }
                    id="keyword"
                    href='@{ix.idg.controllers.routes.IDGApp.targets()+"?facet=MeSH/"}@URLEncoder.encode(m.heading,"utf8")'>@m.heading</a>
                    @if(m.majorTopic) {
                        <a href='http://www.ncbi.nlm.nih.gov/pubmed?term="@m.heading"[MAJR]'><i class="fa fa-external-link"></i></a>
                    } else {
                        <a href='http://www.ncbi.nlm.nih.gov/pubmed?term="@m.heading"[MeSH Terms]'><i class="fa fa-external-link"></i></a>
                    }
                  }
                </div>
             </div>
          </div>
         </div>
         <div class="row">
           <div class="col-md-12">
             <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">MeSH (@mesh.size)</h3>
                </div>
                <div class="panel-body">
                @if(mesh.size > 20) {
                  @for(m <- mesh.subList(0, 20)) {
                    <a @if(m.majorTopic) {
                      class="label label-warning loader"
                    } else {
                      class="label label-primary loader"
                    }
                    id="keyword"
                    href='@{ix.idg.controllers.routes.IDGApp.targets()+"?facet=MeSH/"}@URLEncoder.encode(m.heading,"utf8")'>@m.heading</a>
                    @if(m.majorTopic) {
                        <a href='http://www.ncbi.nlm.nih.gov/pubmed?term="@m.heading"[MAJR]'><i class="fa fa-external-link"></i></a>
                    } else {
                        <a href='http://www.ncbi.nlm.nih.gov/pubmed?term="@m.heading"[MeSH Terms]'><i class="fa fa-external-link"></i></a>
                    }
                  }
                  <a class="label label-danger"
                     data-toggle="modal"
                     data-target="#mesh" href="#">See all...</a>
                } else {
                  @for(m <- mesh) {
                    <a @if(m.majorTopic) {
                      class="label label-warning loader"
                    } else {
                      class="label label-primary loader"
                    }
                    id="keyword"
                    href='@{ix.idg.controllers.routes.IDGApp.targets()+"?facet=MeSH/"}@URLEncoder.encode(m.heading,"utf8")'>@m.heading</a>
                  }
                }
                </div>
             </div>
           </div>
         </div>
       }
    }
    <!--
      -- Publications
      -->
   @if(false && !target.getPublications.isEmpty()) {
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
            <a name="pubs" tocname="Publications"></a>
          <div class="panel-heading">
            <h3 class="panel-title">
                <span data-toggle="tooltip" data-html="true" title="<p align='left'>Publications associated with this target, as identified using the JensenLab text mining protocol</p>">Publication (@target.publications.size)</span>
            </h3>
          </div>
          <div class="panel-body">
            <div class="panel-body table-responsive">
              <table class="table table-striped">
                <tr>
                  <th>PMID <i class="fa fa-external-link"></i></th>
                  <th>Title</th>
                  <th>Relevance</th>
                </tr>
                  @for(xref <- target.links) {
                     @if(xref.kind.equals("ix.core.models.Publication")) {
                       @defining(xref.deRef().asInstanceOf[Publication]) { pub =>
                       <tr>
                        <td><a href="http://www.ncbi.nlm.nih.gov/pubmed/@pub.pmid">@pub.pmid</a></td>
                        <td>@pub.title</td>
                        <td>
                          @for(p <- xref.properties) {
                            @p.label match {
                               case "/uniprot/entry/reference/scope" => {
                                 @label(p, "SCOPE", "default")
                               }
                               case UNIPROT_TISSUE => {
                                  @keyword(p.asInstanceOf[Keyword])
                               }
                               case IDG_GENERIF => {
                                  @**label(p, "GeneRIF", "warning")**@
                                  @if(xref.properties.length > 1) {
                                    <p>
                                  }
                                  <div class="alert alert-success">@p.getValue().toString()</div>
                               }
                               case GWAS_TRAIT => {
                                  @keyword(p.asInstanceOf[Keyword])
                               }
                               case _ => {
                               }
                            }
                          }
                        </td>
                       </tr>
                      }
                    }
                  }
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  }

    @defining(IDGApp.getDrugLigands(target)) { drugs =>
      @ligandcarousel("Drug", drugs)
    }

    @defining(IDGApp.getChemblLigands(target)) { ligands =>
      @ligandcarousel("Ligand", ligands)
    }

  @**************
    Assay
  **************@

  @defining(IDGApp.getAssays(target)) { assays =>
    @if(!assays.isEmpty) {
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
            <a name="assays" tocname="BioAssays"></a>
          <div class="panel-heading">
            <h3 class="panel-title"><span data-toggle="tooltip"
                        data-html="true"
                        title="<p align='left'>Listing of assays reported in PubChem from the Molecular Libraries Program, with total of reported assays with target the reported assay target listed in parenthesis. Summary table table links out to PubChem, list Assay ID, Type of reported assay (summary, confirmatory, other), classification of compounds in assay as Active/Inclusive/Inactive, Description of assay. Note ability to scroll horizontally to view entire table.</p>">MLP Assay (@assays.size)</span> <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/links(kind="+classOf[Assay].getName+")"}'><i class="fa fa-code"></i></a></h3>
          </div>
          <div class="panel-body">
            <div class="panel-body">
	      <div class="table-responsive">
               <table class="table table-striped">
                <tr>
                  <th>AID </th>
                  <th>Type</th>
                  <th>Active&nbsp;/&nbsp;Inconclusive&nbsp;/&nbsp;Inactive</th>
                  <th>Description</th>
                </tr>
		@defining(request().getQueryString("view")) { view =>
		   @view match {
		      case "full" => {
                         @for(a <- assays) {
                            @assayrow(a)
			 }
		      }
		      case _ => {
		         @for(i <- 0 until Math.min(assays.size, 10)) {
			    @assayrow(assays(i))
			 }
			 @if(assays.size > 10) {
			   <tr>
			     <td><a href="@request.uri?view=full">More...</a></td>
			     <td></td>
			     <td></td>
			     <td></td>
			   </tr>
			 }
		      }
		   }
                }
              </table>
             </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  }

  @*************
  Gene RIF
  *************@

  @defining(IDGApp.getGeneRIFs(target)) { generifs =>
    @if(!generifs.isEmpty) {
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
            <a name="generif" tocname="Gene RIF"></a>
          <div class="panel-heading">
            <h3 class="panel-title"><span data-toggle="tooltip"
                        data-html="true"
                        title="<p align='left'>Total count of NCBI Gene Reference Into Function hits for target listed in parenthesis, and summary table with links to publications per PMID with the specific text in article that includes the reported target. </p>">Gene RIF (@generifs.size)</span> <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/links(kind="+classOf[Text].getName+")"}'><i class="fa fa-code"></i></a></h3>
          </div>
          <div class="panel-body">
            <div class="panel-body table-responsive">
              <table class="table table-striped">
                <tr>
                  <th>PMID <i class="fa fa-external-link"></i></th>
                  <th>Text</th>
                </tr>

                  @defining(request().getQueryString("view")) { view =>
                      @view match {
                          case "full" => {
                              @for(x <- generifs) {
                                  <tr>
                                      <td><a href="http://www.ncbi.nlm.nih.gov/pubmed/@x.pmid">@x.pmid</a></td>
                                      <td>@x.text</td>
                                  </tr>
                              }
                          }
                          case _ => {
                              @for(i <- 0 until Math.min(10, generifs.size())) {
                                  <tr>
                                      <td><a href="http://www.ncbi.nlm.nih.gov/pubmed/@generifs(i).pmid">@generifs(i).pmid</a></td>
                                      <td>@generifs(i).text</td>
                                  </tr>
                              }
                              @if(generifs.size() > 10) {
                                  <tr>
                                      <td><a href="@request().uri?view=full">More...</a></td>
                                      <td></td>
                                  </tr>
                              }
                          }
                      }
                  }


              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
    }
    <!--
      -- sequence
      -->
    @defining(IDGApp.getSequence(target)) { seq =>
       @if(seq != null) {
         <div class="row">
           <div class="col-md-12">
             <div class="panel panel-default">
               <a name="seq" tocname="Sequence"></a>
               <div class="panel-heading">
                 <h3 class="panel-title"><span data-toggle="tooltip" title="Amino acid sequence of target protein, bar graph summarizing quantity of each amino acid. Click on looking glass icon for ability to conduct sequence search.">
                     AA Sequence</span> <a title="Sequence search"
		     href="#sequence-modal" data-toggle="modal">
		     <i class="fa fa-search"></i></a>
		   <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/properties(label="+UNIPROT_SEQUENCE+")"}'><i class="fa fa-code"></i></a>
		 </h3>
               </div>
               <div class="panel-body">
		 <div id="aa-profile" style="max-height:200px; width:100%;"></div>
                 <pre class="pre-scrollable">@seq</pre>
               </div>
             </div>
           </div>
         </div>
       }
    }

    @defining(target.getPublications) { pubs =>
       @if(!pubs.isEmpty) {
         <div class="row">
           <div class="col-md-12">
              <div class="panel panel-default">
                 <div class="panel-heading">
                     <a name="tpubs" tocname="Text Mined References"></a>
                     <h3 class="panel-title">
                     <span data-toggle="tooltip" data-html="true"
                     title="<p align='left'>Publications associated with this target, as identified using the JensenLab text mining protocol</p>">
                    Publication</span>
                     <span data-toggle="tooltip" data-html="true" title="<p align='left'>NCBI Gene Bibliography</p>">
                         <a href="http://www.ncbi.nlm.nih.gov/pubmed?LinkName=gene_pubmed&from_uid=@for(kw <- target.synonyms) {@if("Entrez Gene".equals(kw.label)) {@kw.term}}"><i class="fa fa-book"></i></a></span>
                         <span data-toggle="tooltip" data-html="true" title="<p align='left'>Search Pubmed with this target</p>">
                             <a href="http://www.ncbi.nlm.nih.gov/pubmed/?term=@for(kw <- target.synonyms) {@if("UniProt Gene".equals(kw.label)) {@kw.term}}"><i class="fa fa-search-plus"></i></a></span>
                         (@pubs.size) <a class="pull-right" href='@{ix.core.controllers.v1.routes.RouteFactory.get("targets",target.id,null)+"/publications"}'><i class="fa fa-code"></i></a></h3>
                 </div>
                 <div class="panel-body">

                     <div>
                         <ul class="nav nav-tabs" role="tablist">
                             <li role="presentation" class="active"><a href="#pubwc" aria-controls="pubwc" role="tab" data-toggle="tab">Summary</a></li>
                             <li role="presentation"><a href="#publist" aria-controls="publist" role="tab" data-toggle="tab">Details</a></li>
                         </ul>
                         <div class="tab-content">
                             <div role="tabpanel" class="tab-pane active" id="pubwc">
                                 <div id="tpub-wc"></div>
                             </div>
                             <div role="tabpanel" class="tab-pane" id="publist">


                                     <table class="table table-striped">
                                         <tr>
                                             <th>PMID <i class="fa fa-external-link"></i></th>
                                             <th>Year</th>
                                             <th>Title</th>
                                         </tr>
                                         @defining(request().getQueryString("view")) { view =>
                                             @view match {
                                                 case "full" => {
                                                     @for(pub <- pubs) {
                                                         <tr>
                                                             <td><a href="http://www.ncbi.nlm.nih.gov/pubmed/@pub.pmid">@pub.pmid</a></td>
                                                             <td>@pub.year</td>
                                                             <td>@pub.title</td>
                                                         </tr>
                                                     }

                                                 }
                                                 case _ => {
                                                     @for(i <- 0 until Math.min(10, pubs.size())) {
                                                         <tr>
                                                             <td><a href="http://www.ncbi.nlm.nih.gov/pubmed/@pubs.get(i).pmid">@pubs.get(i).pmid</a></td>
                                                             <td>@pubs.get(i).year</td>
                                                             <td>@pubs.get(i).title</td>
                                                         </tr>

                                                     }
                                                     @if(pubs.size() > 10) {
                                                         <tr>
                                                             <td><a href="@request().uri?view=full">More...</a></td>
                                                             <td></td>
                                                         </tr>
                                                     }
                                                 }
                                             }
                                         }
                                     </table>

                             </div>
                         </div>
                     </div>

                        </div>
              </div>


           </div>
         </div>
       }
    }
    <div id="disqus_thread"></div>
    </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" id="loadmodal"
     aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <center><img src='@routes.Assets.versioned("ncats/images/spinners/294.GIF")'></center>
    </div>
  </div>
</div>

<div class="modal fade" id="modal-folder" tabindex="-1"
role="dialog" aria-labelledby="modalLabelFolder" aria-hidden="true">
    <div class="modal-dialog modal-lg" style="width: 40%; ">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modalLabelFolder">Select a dossier</h4>
            </div>
            <div class="modal-body">
                @*<div class="row">*@
            <div id="combo-container" >
                <input id='folder-combobox' class="folder-typeahead" type="text">
                <button type="button" id="button-select-folder" class="btn btn-primary">OK</button>
            </div>
                @*</div>*@
            </div>
        </div>
    </div>
</div>


@modalradar(null, IDGApp.getGeneSymbol(target))


<head>
    <!--<script src='@routes.WebJarAssets.at(WebJarAssets.locate("js/highcharts.js"))' type='text/javascript'></script>-->
    <!--<script src='@routes.WebJarAssets.at(WebJarAssets.locate("js/highcharts-more.js"))' type='text/javascript'></script>-->
    <!--<script src="https://code.highcharts.com/modules/exporting.js"></script>-->
    <!--<script src="https://code.highcharts.com/js/modules/offline-exporting.js"></script>-->
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/d3.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/tinx.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/d3-tip.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/radar-chart.js")'></script>
    <script type="text/javascript" src='@routes.WebJarAssets.at(WebJarAssets.locate("raphael-min.js"))'></script>
    <script type="text/javascript" src='@routes.WebJarAssets.at(WebJarAssets.locate("morris.min.js"))'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/underscore.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/underscore.string.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/cart.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/d3.layout.cloud.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/wordcloud.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/jquery.sparkline.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/flickity.pkgd.min.js")'></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/stupidtable.min.js")'></script>
    <link type="text/css" rel="stylesheet" href='@routes.Assets.versioned("stylesheets/d3-tip.css")' />
    <link type="text/css" rel="stylesheet" href='@routes.Assets.versioned("stylesheets/radar-chart.css")' />
    <link type="text/css" rel="stylesheet" href='@routes.WebJarAssets.at(WebJarAssets.locate("morris.css"))' />
    <link type="text/css" rel="stylesheet" href='@routes.Assets.versioned("ncats/css/loader.css")'/>
    <link type="text/css" rel="stylesheet" href='@routes.Assets.versioned("stylesheets/flickity.css")'/>
    <link type="text/css" rel="stylesheet" href='@routes.Assets.versioned("stylesheets/main.css")'/>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script type="text/javascript" src='@routes.Assets.versioned("javascripts/viz.js")'></script>
    <!--<link type="text/css" rel="stylesheet" href="https://code.highcharts.com/css/highcharts.css"></script>-->

    <style type="text/css">


    .carousel-image {
       min-width: 100px;
       min-height: 190px;
    }

    .carousel-cell {
       width: 150px;
    }

    .flickity-page-dots {
       bottom: -2px;
    }
    </style>
</head>

<script>
var disqus_config = function () {
   this.page.url = '@{Global.getHost()+ix.idg.controllers.routes.IDGApp.target(IDGApp.getId(target))}';
   this.page.identifier = '@ix.idg.controllers.routes.IDGApp.target(IDGApp.getId(target))';
   this.page.title='[@IDGApp.getId(target)] @target.getName';
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//pharos-idg.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<script>
$(function () {
  $('[data-toggle="popover"]').popover();
  $('[data-toggle="tooltip"]').tooltip();
});

$(document).ready(function () {
    $("#diffexptable").stupidtable();

    /* populate TOC menu */
    var tocs = [];
    $("a[tocname]" ).each(function(){
        var aname = $(this ).attr("name");
        var tname = $(this ).attr("tocname");
        tocs.push( {aname:aname, tname:tname} );
    });
    tocs = _.sortBy(tocs, 'tname');
    _.each(tocs, function(o, idx, l) {
        $("#toc" ).append("<li><a href='#"+ o.aname+"'>"+ o.tname+"</a></li>");
    });
    $('#toc').append('<li role="separator" class="divider"></li>');
    $('#toc').append('<li><a href="@ix.core.controllers.v1.routes.RouteFactory.get("targets", target.id, null)">View JSON</a></li>');
    $('#toc').append('<li><a class="loader" href="@HtmlFormat.raw(request.uri)?action=download">Download</a></li>');

    /* Word cloud for text mined pubs */
    @defining(WordCloud.textHistogram(target, "title", "sqrt")) { counts =>
        wordcloud ("tpub-wc", 800, 300,
                '@ix.idg.controllers.routes.IDGApp.targets(null,10,1)', [
            @for(count <- counts) {
                {text:'@count.label', size:@count.numval},
            }
        ]);

        var tpubwc = $('#tpub-wc svg:first-child');
	    tpubpanel = $('#tpub-wc'),
	    tpubasp = tpubpanel.width()/tpubpanel.height();

        $(window).on("resize", function() {
	   var w = tpubpanel.width();
	   var h = Math.round(w/tpubasp);
	   //tpubwc.attr("preserveAspectRatio", "xMinYMin meet");
   	   //tpubwc.attr("viewBox", "0 0 "+w+" "+h);
	   tpubwc.attr("width", w);
	   tpubwc.attr("height", h);
	   //tpubwc.attr("transform", "translate("+w/2+","+h/2+")");
	}).trigger("resize");
    }

   $('.ligand-carousel').flickity({
      cellAlign: 'center',
      contain: true,
      freeScroll: true
   });

   $("a[id|='exprtab']").click(function () {
       var p = $(this).attr("id").indexOf('-');
       if (p > 0) {
          var tissue = $(this).attr("id").substring(p+1);
          $('#tissue-descriptor').attr("href", '@ix.idg.controllers.routes.IDGApp.targetdescriptor("")'+tissue);
          console.log('tissue \''+tissue+'\'');
       }
    });

    /* Cart related methods and vars */
    $.ajax({
        url:'@ix.idg.controllers.routes.DossierApp.count',
        dataType:'text',
        success:function(d) {
            $("#sc-count" ).html(d);
        }
    });

    var folderNames = ['Default'];
    @for(f <- ix.idg.controllers.DossierApp.getFolderNames()) {
        @if(!f.equals("")) {
            folderNames.push ( ' @f ');
        }
    }

    $("#sc-empty").click(function (e) {
       $.get('@ix.idg.controllers.routes.DossierApp.emptyCart', function (d) {
            $("#sc-count" ).html('');
       });
    });

    $("#folder-combobox").typeahead(
        {hint:true,minLength:1,highlight:true },
        {source:substringMatcher(folderNames), name:'dossiers'}
    );
    $('#folder-combobox' ).typeahead('val', "Default");
    $('#folder-combobox').on("typeahead:selected", function (evt, val, d) {
        if (d == 'MeSH') {}
        else $('#folder-combobox').typeahead('val', +val.value);
    });

    $("#button-select-folder" ).on('click', function() {
        $('#modal-folder').modal('hide');
        var selectedFolderName = $("#folder-combobox" ).typeahead('val');
        addEntitiesToShoppingCart(['@IDGApp.getId(target)'], 'ix.idg.models.Target',
            selectedFolderName, '@ix.idg.controllers.routes.DossierApp.addEntities()');
    });

    // select all checkboxes in the table
    $("#sc-add-selected" ).click(function(e) {
        $('#modal-folder').modal('show');
    });

/* ***************************************** */
$('.tree').treegrid({
     expanderExpandedClass: 'fa fa-angle-down',
     expanderCollapsedClass: 'fa fa-angle-right',
     initialState: 'collapsed'
  });

//  $('#keyword').on('click touchstart', function () {
//     showLoadModal();
//  });

    $.ajax({
        url: '@ix.idg.controllers.routes.IDGApp.targetTissue(IDGApp.getId(target))',
        dataType: "json",
        success: function (data) {
            var config = {
                chart: {
                    polar: true,
                    type: "line",
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: null
                },
                legend: {
                    enabled: false
                },
                pane: {
                    size: "75%"
                },
                yAxis: {
                    gridLineInterpolation: 'polygon',
                    lineWidth: 0,
                    min: 0,
                    labels: {
                        enabled: false
                    }
                },
                xAxis: {
                    categories: _.map(data[0].axes, function (obj) {
                        return (obj.axis);
                    }),
                    tickmarkPlacement: 'on',
                    lineWidth: 0,
                    autoRotation: false
                },
                series: [{
                    name: "",
                    data: _.map(data[0].axes, function (obj) {
                        return (obj.value);
                    }),
                    pointPlacement: 'on'
                }]
            };
            config = _.extend(config, defaultExportConfig);
            Highcharts.chart("tissue-specificity-radar", config);
        }
    });

    $('#attr-type-radar').html('<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span>');
    $.ajax({
        url: '@ix.idg.controllers.routes.HarmonogramApp.hgForTarget(null,null,null,"radar-attr_type")&q=@IDGApp.getId(target)',
        dataType: "json",
        success: function (data) {
            $('#attr-type-radar').html('');
            renderChart(data, 'radar-attr_type', 'attr-type-radar',
                    {
                        chart: {
                            polar: true,
                            type: "line",
                            height: 200,
                            backgroundColor: 'rgba(255, 255, 255, 0.1)',
                            margin: [0, 0, 0, 0],
                            spacing: [5, 5, 5, 5]
                        },
                        plotOptions: {
                            line: {
                                animation: false
                            },
                            series: {
                                enableMouseTracking: false,
                                lineWidth: 2,
                                states: {
                                    hover: {
                                        enabled: false
                                    }
                                }
                            }
                        },
                        pane: {size: "75%"},
                        xAxis: {
                            categories: _.map(data[0].axes, function (obj) {
                                return "";
                            }),
                            maxPadding: 0.05,
                            lineWidth: 0
                        }
                    });
        },
        error: function () {
            $('#attr-type-radar').html('<h5><em>No data available</em></h5>');
            $('#modal-radar-btn').attr('disabled', 'true');
        }
    });

    $.ajax({
        url: '@ix.idg.controllers.routes.HarmonogramApp.hgForTarget(null,null,null,"radar-attr_type")&q=@IDGApp.getId(target)',
        dataType:"json",
        success:function(data) {
	    //console.log('rendering radar in modal...'+JSON.stringify(data));
            $('#modal-radardiv').html('');
            var config = {
                chart: {
                    polar: true,
                    type: "line"
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: null
                },
                legend: {
                    enabled: false
                },
                pane: {
                    size: "90%"
                },
                yAxis: {
                    gridLineInterpolation: 'polygon',
                    lineWidth: 0,
                    min: 0,
                    labels: {
                        enabled: false
                    }
                },
                xAxis: {
                    categories: _.map(data[0].axes, function (obj) {
                        return (obj.axis);
                    }),
                    tickmarkPlacement: 'on',
                    lineWidth: 0.5,
                    autoRotation: true
                },
                series: [{
                    name: "Attribute Type",
                    marker: {enabled: false},
                    point: {
                        events: {
                            mouseOver: function () {
                                var category = this.category;
                                showDataSources('#radar-ds-container',
                                        '@ix.idg.controllers.routes.HarmonogramApp.dataSources(null,null)' +
                                        '?field=radar-attr_type')({name: category});
                            }
                        }
                    },
                    data: _.map(data[0].axes, function (obj) {
                        return (obj.value);
                    })
                }]
            };
            config = _.extend(config, defaultExportConfig);
            var chart = Highcharts.chart("modal-radardiv", config);

	      $('#modal-radar').on('show.bs.modal', function() {
	          $('#modal-radardiv').css('visibility', 'hidden');
	      });
	      $('#modal-radar').on('shown.bs.modal', function() {
	          $('#modal-radardiv').css('visibility', 'initial');
	          chart.reflow();
	      });

              $("#modalLabelRadar" ).html
                     ('<h4><span class="label label-@target.idgTDL.label">@target.idgTDL</span> @target.getName</h4>');
          }
     });

    function _renderChart(chartData, aggType) {
        $("#modal-radardiv" ).empty();
        $("#radar-ds-container" ).empty();
        renderChart(chartData, aggType, 'modal-radardiv');
        $("#modalLabelRadar" ).html
           ('<h4><span class="label label-@target.idgTDL.label">@target.idgTDL</span> @target.getName</h4>');
        $("#modal-radar" ).modal("show");
    }


    function _handleModalSelectEvents(aggTypeElem, overlayElem, target) {
        var aggType = $(aggTypeElem).val();
        var overlay = $(overlayElem).val();

        var promises = [$.get('@ix.idg.controllers.routes.HarmonogramApp.hgForTarget(null,null,null,null)' + '?q=' + target + '&type=' + aggType)];
        if (overlay == 'none') {
            // promises.push($.Deferred().resolve().promise());
        } else if (overlay.includes("dossier-")) {
            var opt = $(overlayElem).find(":selected");
            var tids = $(opt).attr("tids").split(",");
            if (tids.length == 0) return;
            _.each(tids, function (x) {
                promises.push($.get('@ix.idg.controllers.routes.HarmonogramApp.hgForTarget(null, null, null, null)' + '?q=' + x + '&type=' + aggType));
            });
        } else
            promises.push($.get('@ix.idg.controllers.routes.HarmonogramApp.hgForTarget(null,null,null,null)' + '?q=' + overlay + '&type=' + aggType));
        $.when.apply($, promises).then(function () {
            // first should be the target in question, the rest will be overlays
            var chartData = _.map(arguments, function (arr) {
                if (arr == "success") return (undefined);
                if (_.isString(arr)) return (JSON.parse(arr)[0]);
                else if (_.isArray(arr)) return (JSON.parse(arr[0])[0]);
                else return (undefined);
            });
            chartData = _.filter(chartData, function (x) {
                return (x != undefined);
            });
            renderChart(chartData, "radar-attr_type", 'modal-radardiv', {legend: {enabled: true}});
            $("#modal-radar").modal("show");
        });
    }

    $("#select-agg").on('change', function () {
        _handleModalSelectEvents($(this), $("#select-overlay"), $("#modal-radardiv").attr("target"));
    });

    $("#select-overlay").on('change', function () {
        _handleModalSelectEvents($("#select-agg"), $(this), $("#modal-radardiv").attr("target"));
    });


    plotAAProfile('aa-profile');

   @if(target.patentCount != null && target.patentCount > 0) {
      var data = @HtmlFormat.raw(IDGApp.getPatents(target).toString);
      var patentCountPlotConfig = {
                chart: {
                  type: 'line'
                },
                credits: {
                  enabled: false
                },
                title: {
                   text: null
                },
                legend: {
                   enabled: false
                },
                xAxis: {
                   categories: _.map(data, function (d) { return d.year; })
                },
                yAxis: {
                   title: {
                      text: 'Count'
                   }
                },
                tooltip: {
                   shared: true,
                   crosshairs: true
                },
                series: [{
                   name: 'Count',
                   marker: {
                     radius: 3
                   },
                   data: _.map(data, function(d) { return parseInt(d.count,10); })
                }]
            };
      patentCountPlotConfig = _.extend(patentCountPlotConfig, defaultExportConfig);
      Highcharts.chart('patent-line-plot', patentCountPlotConfig);
   }

   @if(target.pubTatorScore != null) {
      var data = @HtmlFormat.raw(IDGApp.getPubTator(target).toString);
      var pubtatorPlotConfig = {
                chart: {
                  type: 'line'
                },
                credits: {
                  enabled: false
                },
                title: {
                   text: null
                },
                legend: {
                   enabled: false
                },
                xAxis: {
                   categories: _.map(data, function (d) { return d.year; })
                },
                yAxis: {
                   title: {
                      text: 'Score'
                   }
                },
                tooltip: {
                   shared: true,
                   crosshairs: true
                },
                series: [{
                   name: 'PubTator Score',
                   marker: {
                     radius: 3
                   },
                   data: _.map(data, function(d) { return d.score; })
                }]
            };
            pubtatorPlotConfig = _.extend(pubtatorPlotConfig, defaultExportConfig);
      Highcharts.chart('pubtator-plot', pubtatorPlotConfig);
   }

   @if(target.jensenScore != null) {
      var data = @HtmlFormat.raw(IDGApp.getPubMedScore(target).toString);
      var jensenPlotConfig = {
                chart: {
                  type: 'line'
                },
                credits: {
                  enabled: false
                },
                title: {
                   text: null
                },
                legend: {
                   enabled: false
                },
                xAxis: {
                   categories: _.map(data, function (d) { return d.year; })
                },
                yAxis: {
                   title: {
                      text: 'Score'
                   }
                },
                tooltip: {
                   shared: true,
                   crosshairs: true
                },
                series: [{
                   name: 'PubMed Score',
                   marker: {
                     radius: 3
                   },
                   data: _.map(data, function(d) { return d.score; })
                }]
            };
      jensenPlotConfig = _.extend(jensenPlotConfig, defaultExportConfig);
      Highcharts.chart('pubmedscore-plot', jensenPlotConfig);
   }

   $('#pmscore-sparkline').sparkline('html', {width:'100px'});
   tinx_target_plot("#tinx-plot", "@IDGApp.getId(target)");
});

function plotAAProfile(container) {
    var config = {
        chart: {
            type: 'column',
            height: 150
        },
        title: {
            text: null
        },
        credits: {enabled: false},
        xAxis: {
            /*
             categories:['A','R','N','D','C','E','Q','G','H','I',
             'L','K','M','F','P','S','T','W','Y','V'],*/
            categories: ['@target.name'],
            title: {
                text: null
            },
            labels: {
                enabled: false,
            }
        },
        yAxis: {
            min: 0,
            title: {
                text: null
            }
        },
        legend: {
            enabled: false
        },
        series: @HtmlFormat.raw(IDGApp.getAminoAcidProfile(target).toString)
    };
    config = _.extend(config, defaultExportConfig);
    var chart = Highcharts.chart(container, config);
}

function showLoadModal () {
   $('#page-loader').addClass('loader-wait');
/*
  $('#loadmodal').modal({
      keyboard: false,
      show: true,
      backdrop: 'static'
        });
*/
}

$(window).on("unload", function (e) {
    $('#loadmodal').modal('hide');
});
</script>

<script id="dsq-count-scr" src="//pharos-idg.disqus.com/count.js" async></script>
}
