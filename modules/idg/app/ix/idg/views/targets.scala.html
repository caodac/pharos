@import ix.idg.models.Target
@import ix.idg.controllers.IDGApp
@import ix.idg.controllers.Commons._
@import ix.ncats.controllers.App.FacetDecorator

@(current: Int, rows: Int, total: Int, pages: Array[Int],
        facets: Array[FacetDecorator], targets: List[Target], searchCacheKey: String )


@tabrow(t: Target) = {
    <tr id="row-@IDGApp.getId(t)">
        <td><a id='load' onclick="showLoadModal()" 
	   href="@ix.idg.controllers.routes.IDGApp.target(IDGApp.getId(t))">@t.name</a></td>
        <td><span class="label label-@t.idgTDL.label" data-toggle="tooltip"
        data-html="true" title="<p align='left'>@t.idgTDL.desc</p>">@t.idgTDL.name</span></td>
        <td>@IDGApp.format(t.novelty)</td>
        <td>@t.idgFamily</td>
    </tr>
}

@ix.ncats.views.html.content("Targets", "ix.idg.models.Target",
    ix.idg.controllers.routes.IDGApp.targets().url,
    current, rows, total, pages, facets) {
    @menu("ix.idg.models.Target") {
        <ul class="nav navbar-nav navbar-left">
            <li role="presentation"><a href="@ix.idg.controllers.routes.IDGApp.diseases(null, 10, 1)">Diseases</a></li>
            <li role="presentation" class="active"><a href="#">Targets</a></li>
            <li role="presentation"><a href="@ix.idg.controllers.routes.IDGApp.ligands(null, 8, 1)">Ligands</a></li>
        </ul>
    }
} {
    <ol class="breadcrumb">
        <li><a href="@ix.idg.controllers.routes.IDGApp.index()"><span class="fa fa-home"></span> Home</a></li>
        @defining(request().queryString.get("facet")) { facets =>
            @if(facets != null) {
                <li><a href="@ix.idg.controllers.routes.IDGApp.targets()">Targets</a></li>
                @for(f <- facets) {
                    @if(f.startsWith(DTO_PROTEIN_CLASS)) {
                        @for(a <- IDGApp.getProteinAncestry(f)) {
                            <li><a href="@a.href">@a.term</a></li>
                        }
                        <li class="active">@f.substring(f.indexOf('/') + 1)</li>
		    }
		    @if(f.startsWith(PANTHER_PROTEIN_CLASS)) {
                        @for(a <- IDGApp.getAncestry(f, PANTHER_PROTEIN_ANCESTRY)) {
                            <li><a href="@a.href">@a.term</a></li>
                        }
                        <li class="active">@f.substring(f.indexOf('/') + 1)</li>
		    }
		    @if(f.startsWith(ChEMBL_PROTEIN_CLASS)) {
                        @for(a <- IDGApp.getAncestry(f, ChEMBL_PROTEIN_ANCESTRY)) {
                            <li><a href="@a.href">@a.term</a></li>
                        }
                        <li class="active">@f.substring(f.indexOf('/') + 1)</li>
		    }
                }
            } else {
                <li class="active">Targets</li>
            }
        }
    </ol>
} {
    @* TODO REMOVE after testing *@
    <a target="_blank" href='@{ix.idg.controllers.routes.HarmonogramApp.view()+"?cache=" + searchCacheKey}'>Harmonogram</a>

    <table id="target-table" class="table table-hover">
        <tr>
            <th>Name</th>
            <th>Development Level</th>
            <th>Novelty</th>
            <th>Target Family</th>
        </tr>
        @for(t <- targets) {
            @tabrow(t)
        }
    </table>
} {
    <div id="word-cloud"></div>
}

<div class="modal fade" tabindex="-1" role="dialog" id="loadmodal"
     aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <center><img src='@routes.Assets.at("ncats/images/spinners/294.GIF")'></center>
    </div>
  </div>
</div>


<head>
    <style type="text/css">
    </style>
    <script type="text/javascript" src='@routes.Assets.at("javascripts/d3.js")'></script>
    <script type="text/javascript" src='@routes.Assets.at("javascripts/d3.layout.cloud.js")'></script>
</head>

<script>
$(function() {
   $('[data-toggle="popover"]').popover();
   $('[data-toggle="tooltip"]').tooltip ();
});




$(document).ready(function () {
   jQuery('#content-tab a[href="#viz"]').click(function (e) {
      e.preventDefault()
      jQuery(this).tab('show');
      // Added this line to force NVD3 to redraw the chart
      //jQuery(window).trigger('resize');
      d3.select('svg').remove();
      //window.dispatchEvent(new Event('resize'));
	      console.log('tab shown: '+e.target);
   });
   $('#loadmodal').on('shown.bs.modal', function (e) {
      console.log('modal is shown...');
   });
});

function showLoadModal () {
  console.log('showing modal...');
  $('#loadmodal').modal({
      keyboard: false,
      show: true,
      backdrop: 'static'
    });
}

$(window).unload(function () {
    $('#loadmodal').modal('hide');    
});
</script>
