
@import ix.idg.models.Target
@import ix.idg.models.Ligand
@import ix.idg.models.Disease
@import ix.core.models.Value
@import ix.core.models.Keyword
@import ix.core.models.Publication
@import ix.idg.controllers.IDGApp
@import ix.idg.controllers.IDGApp._
@import ix.idg.controllers.Commons._
@import ix.idg.controllers.TcrdRegistry
@import ix.idg.controllers.UniprotRegistry
@import ix.utils.Util
@import java.net.URLEncoder

@(target: Target, diseases: List[DiseaseRelevance], breadcrumb: List[Keyword])

@label(x: Value, title: String, label: String) = {
  @if(x.getValue().toString().length() > 50) {
       <a class="label label-@label"
           href="#@Util.sha1(x.getValue().toString()).substring(0,6)"
           tabindex="0"
           data-toggle="popover"
           data-animation="true"
           data-placement="top"
           data-trigger="click hover focus"
           data-title="@title"
           data-content="@x.getValue()">@x.getValue().toString().substring(0, 50)...</a></span>
  } else {
      <span class="label label-@label">@x.getValue()</span>
  }
}

@diseasedblink(d: Disease, x: Any) = {
<a href="http://diseases.jensenlab.org/Entity?order=textmining,knowledge,experiments&textmining=10&knowledge=10&experiments=10&type1=-26&type2=9606&id1=@IDGApp.getId(d)">@x</a>
}

@diseaserow(dr: DiseaseRelevance) = {
   @if(dr.zscore != null) {
     <tr class="treegrid-@dr.disease.id">
       <td><a href="@ix.idg.controllers.routes.IDGApp.disease(IDGApp.getId(dr.disease))">@dr.disease.name</a></td>
       <td>@diseasedblink(dr.disease,dr.zscore)</td>
       <td>@diseasedblink(dr.disease,dr.conf)</td>
       @if(dr.tinxScore != null) {
       <td>@{"%1$.3f".format(-Math.log(dr.tinxScore))}</td>
       } else {
       <td></td>
       }
     </tr>

     @for(i <- 0 until dr.lineage.size()) {
       @defining(dr.lineage(i)) { x =>	    
         <tr class="treegrid-@x.disease.id treegrid-parent-@dr.disease.id">
            <td><a href="@ix.idg.controllers.routes.IDGApp.disease(IDGApp.getId(x.disease))">@x.disease.name</a></td>
            <td>@diseasedblink(x.disease,x.zscore)</td>
            <td>@diseasedblink(x.disease,x.conf)</td>
	    @if(x.tinxScore != null) {
	    <td>@{"%1$.3f".format(-Math.log(x.tinxScore))}</td>
	    } else {
	    <td></td>
	    }
         </tr>
       }
     }
   }
}
      
@ix.ncats.views.html.main(target.name, target.getClass().getName()){
@menu(target.getClass().getName()){
<ul class="nav navbar-nav navbar-left">
  <li role="presentation"><a href="@ix.idg.controllers.routes.IDGApp.diseases(null,10,1)">Diseases</a></li>
  <li role="presentation" class="active"><a href="#">Targets</a></li>
  <li role="presentation"><a href="@ix.idg.controllers.routes.IDGApp.ligands(null,8,1)">Ligands</a></li>
</ul>
}
}{
<ol class="breadcrumb">
  <li><a href="@ix.idg.controllers.routes.IDGApp.index()"><span class="fa fa-home"></span> Home</a></li>
    <li><a href="@ix.idg.controllers.routes.IDGApp.targets()">Targets</a></li>
    @for(kw <- breadcrumb) {
    <li><a href="@kw.href">@kw.term</a></li>
    }
    <li class="active">@target.name</li>
</ol>
}{
<div class="container-fluid">
  <div class="col-md-12">
    <div class="page-header">
      <h1>
        <table>
        <tr>
         <td>
           <span class="label label-@target.idgTDL.label"
		 data-toggle="tooltip" data-html="true" data-placement="right"
		 title="<p align='left'>@target.idgTDL.desc</p>">@target.idgTDL</span>
         </td>
         <td style="padding:5px;"></td>
         <td>@target.name</td>
        </tr>
        </table>
      </h1>
      @if(target.description != null) {
	<div class="panel panel-default">
	  <div class="panel-body">
	    <p>@target.description
	  </div>
	</div>
      }
    </div>
    <div class="row">
      <!--
        -- Synonyms
        -->
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Synonyms</h3>
          </div>
          <div class="panel-body">
            <table class="table">
              <tr>
                <td>Accession</td>
                <td>
                  @for(kw <- target.synonyms) {
                     @if("UniProt Accession".equals(kw.label)) {
                        <a href="@kw.href">@kw.term</a>
                     }
                  }
                </td>
              </tr>
              <tr>
                <td>Fullname</td>
                <td>
                  @for(kw <- target.synonyms) {
                     @if("UniProt Fullname".equals(kw.label)) {
                        @kw.term<br>
                     }
                  }
                </td>
              </tr>
              <tr>
                <td>Shortname</td>
                <td>
                  @for(kw <- target.synonyms) {
                     @if("UniProt Shortname".equals(kw.label)) {
                             @kw.term<br>
                     }
                  }
                </td>
              </tr>
            </table>
          </div>
        </div>
      <!--
        -- Genes
        -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Genes</h3>
          </div>
          <div class="panel-body">
            @for(kw <- target.synonyms) {
                @if("UniProt Gene".equals(kw.label)) {
                    <a href="http://www.genenames.org/cgi-bin/gene_symbol_report?match=@kw.term">@kw.term</a>
                }
            }
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Ligands</h3>
          </div>
          <div class="panel-body">
           <table>
	    @for(ref <- target.links) {
	       @if(ref.kind.equalsIgnoreCase("ix.idg.models.Ligand")) {
	           @defining(ref.deRef().asInstanceOf[Ligand]) { lig =>
		     <tr>
		       <td>
		         <a tabindex="-1"
			    data-toggle="popover"
			    data-animation="true"
                            data-placement="top"
           		    data-trigger="click hover focus"
           		    data-title="@lig.getName()"
	   		    data-html="true"
           		    data-content="<img src='@ix.ncats.controllers.routes.App.structure(IDGApp.getStructure(lig).id,"svg",150)'>">
			   <img alt="Structure of @IDGApp.getId(lig)"
			       src='@ix.ncats.controllers.routes.App.structure(IDGApp.getStructure(lig).id,"svg",80)'></a>
		       </td>
		       <td class="valign-center">
		          <a href='@ix.idg.controllers.routes.IDGApp.ligand(IDGApp.getId(lig))'>@lig.getName()</a>
		       </td>
		     </tr>
                  }
               }
	    }
	    </table>
	  </div>
	</div>
      </div>	
      <!--
        -- Disease Relevance
        -->
      <div class="col-md-8">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">IDG Disease Relevance (@diseases.size())</h3>
          </div>
          <div class="panel-body">
            <table class="tree table">
              <tr>
                <th>Disease</th>
                <th>Z-score <i class="fa fa-info-circle"
		data-toggle="tooltip" data-placement="top" data-html="true"
                title="<p align='left'>A normalized version of the co-occurence (of the disease and this target) score, described in <a href='http://www.sciencedirect.com/science/article/pii/S1046202314003831'>Franklid et al, Methods, 2015, 83-89</a></p>"></i></th>
                <th>Confidence <i class="fa fa-info-circle"
		data-toggle="tooltip" data-placement="top" data-html="true"
                title="<p align='left'>Half the Z-score, described in <a href='http://www.sciencedirect.com/science/article/pii/S1046202314003831'>Franklid et al, Methods, 2015, 83-89</a></p>"></i></th>
	        <th>Importance <i class="fa fa-info-circle"
		data-toggle="tooltip" data-placement="top" data-html="true"
                title="<p align='left'>A -log score characterizing the importance of the target, based on occurences in the published literature. Smaller values indicate increased importance.</p>"></i></th>
              </tr>
	      @defining(request().getQueryString("view")) { view =>
	        @view match {
	          case "full" => {
                    @for(dr <- diseases) {
		      @diseaserow(dr)
	            }
		  }
  		  case _ => {
		    @for(i <- 0 until Math.min(10, diseases.size())) {
		       @diseaserow(diseases(i))
		    }
		    @if(diseases.size() > 10) {
		      <tr>
		        <td><a href="@request().uri?view=full">More...</a></td>
		        <td></td>
		        <td></td>
			<td></td>
		      </tr>
		    }
		  }
 	        }
	      }
            </table>
          </div>
        </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">UniProt Disease Relevance</h3>
              </div>
              <div class="panel-body">
                <table class="table table-striped">
                  <tr>
                    <th>Disease</th>
                    <th>OMIM</th>
                    <th>Comment</th>
                  </tr>
                  @for(dr <- diseases) {
                    @if(dr.comment != null) {
                    <tr>
                      <td><a href="@ix.idg.controllers.routes.IDGApp.disease(IDGApp.getId(dr.disease))">@dr.disease.name</a></td>
                      @if(dr.omim != null) {
                      <td><a href="@dr.omim.href">@dr.omim.term</a></td>
                      } else {
                      <td></td>
                      }
                      <td>@dr.comment"  "</td>
                    </tr>
                    }
                  }
                </table>
            </div>
           </div>
      </div>
    </div> <!-- row -->
    <!--
      -- Annotations
      -->
    <!--
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Annotations</h3>
          </div>
          <div class="panel-body">
            <table class="table table-striped">
              <tr>
                <th>Type</th>
                <th>Value</th>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- 
      -- Publications
      -->
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Publications</h3>
          </div>
          <div class="panel-body">
            <div class="panel-body">
              <table class="table table-striped">
                <tr>
                  <th>PMID</th>
                  <th>Title</th>
                  <th>Relevance</th>
                </tr>
                  @for(xref <- target.links) {
                     @if(xref.kind.equals("ix.core.models.Publication")) {
                       @defining(xref.deRef().asInstanceOf[Publication]) { pub =>
                       <tr>
                        <td><a href="http://www.ncbi.nlm.nih.gov/pubmed/@pub.pmid">@pub.pmid</a></td>
                        <td>@pub.title</td>
                        <td>
                          @for(p <- xref.properties) {
                            @p.label match {
                               case "/uniprot/entry/reference/scope" => {
                                 @label(p, "SCOPE", "default")
                               }
                               case UNIPROT_TISSUE => {
                                    <a class="label label-primary" href='@{ix.idg.controllers.routes.IDGApp.targets()+"?facet="+UNIPROT_TISSUE+"/"}@URLEncoder.encode(p.getValue().toString(), "utf8")'>@p.getValue()</a>
                               }
                               case IDG_GENERIF => {
                                  @label(p, "GeneRIF", "warning")
                               }
                               case _ => {
                               }
                            }
                          }
                        </td>
                       </tr>
                      }
                    }
                  }
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
}

<script>
$(function () {
  $('[data-toggle="popover"]').popover();
  $('[data-toggle="tooltip"]').tooltip();
});

$(document).ready(function () { 
  $('.tree').treegrid({
   expanderExpandedClass: 'fa fa-angle-down',
   expanderCollapsedClass: 'fa fa-angle-right',
   initialState: 'collapsed'
  });
});
</script>
